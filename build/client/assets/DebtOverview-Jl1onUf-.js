import{c as O}from"./createLucideIcon-BSR5BV8j.js";import{r,l as e}from"./chunk-KNED5TY2-Cl3wCyk9.js";import{a as L}from"./axios-DieNybu2.js";import{a as U}from"./firebase-CTRYxaob.js";import{B as I}from"./Button-XTR6J30C.js";import{D as z,b as A,c as F,d as B,f as T,e as H}from"./Dialog-CQYq49fn.js";import{M as S,u as P,P as W,a as _,b as K,L as G,m as V}from"./proxy-BMHVCQmy.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ae=O("plus",X);class q extends r.Component{getSnapshotBeforeUpdate(d){const s=this.props.childRef.current;if(s&&d.isPresent&&!this.props.isPresent){const i=s.offsetParent,f=i instanceof HTMLElement&&i.offsetWidth||0,o=this.props.sizeRef.current;o.height=s.offsetHeight||0,o.width=s.offsetWidth||0,o.top=s.offsetTop,o.left=s.offsetLeft,o.right=f-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function J({children:n,isPresent:d,anchorX:s}){const i=r.useId(),f=r.useRef(null),o=r.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=r.useContext(S);return r.useInsertionEffect(()=>{const{width:g,height:a,top:t,left:l,right:m}=o.current;if(d||!f.current||!g||!a)return;const p=s==="left"?`left: ${l}`:`right: ${m}`;f.current.dataset.motionPopId=i;const h=document.createElement("style");return u&&(h.nonce=u),document.head.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${a}px !important;
            ${p}px !important;
            top: ${t}px !important;
          }
        `),()=>{document.head.removeChild(h)}},[d]),e.jsx(q,{isPresent:d,childRef:f,sizeRef:o,children:r.cloneElement(n,{ref:f})})}const Q=({children:n,initial:d,isPresent:s,onExitComplete:i,custom:f,presenceAffectsLayout:o,mode:u,anchorX:g})=>{const a=P(Y),t=r.useId();let l=!0,m=r.useMemo(()=>(l=!1,{id:t,initial:d,isPresent:s,custom:f,onExitComplete:p=>{a.set(p,!0);for(const h of a.values())if(!h)return;i&&i()},register:p=>(a.set(p,!1),()=>a.delete(p))}),[s,a,i]);return o&&l&&(m={...m}),r.useMemo(()=>{a.forEach((p,h)=>a.set(h,!1))},[s]),r.useEffect(()=>{!s&&!a.size&&i&&i()},[s]),u==="popLayout"&&(n=e.jsx(J,{isPresent:s,anchorX:g,children:n})),e.jsx(W.Provider,{value:m,children:n})};function Y(){return new Map}const b=n=>n.key||"";function k(n){const d=[];return r.Children.forEach(n,s=>{r.isValidElement(s)&&d.push(s)}),d}const Z=({children:n,custom:d,initial:s=!0,onExitComplete:i,presenceAffectsLayout:f=!0,mode:o="sync",propagate:u=!1,anchorX:g="left"})=>{const[a,t]=_(u),l=r.useMemo(()=>k(n),[n]),m=u&&!a?[]:l.map(b),p=r.useRef(!0),h=r.useRef(l),C=P(()=>new Map),[M,R]=r.useState(l),[j,D]=r.useState(l);K(()=>{p.current=!1,h.current=l;for(let x=0;x<j.length;x++){const c=b(j[x]);m.includes(c)?C.delete(c):C.get(c)!==!0&&C.set(c,!1)}},[j,m.length,m.join("-")]);const N=[];if(l!==M){let x=[...l];for(let c=0;c<j.length;c++){const y=j[c],v=b(y);m.includes(v)||(x.splice(c,0,y),N.push(y))}return o==="wait"&&N.length&&(x=N),D(k(x)),R(l),null}const{forceRender:w}=r.useContext(G);return e.jsx(e.Fragment,{children:j.map(x=>{const c=b(x),y=u&&!a?!1:l===j||m.includes(c),v=()=>{if(C.has(c))C.set(c,!0);else return;let E=!0;C.forEach($=>{$||(E=!1)}),E&&(w==null||w(),D(h.current),u&&(t==null||t()),i&&i())};return e.jsx(Q,{isPresent:y,initial:!p.current||s?void 0:!1,custom:d,presenceAffectsLayout:f,mode:o,onExitComplete:y?void 0:v,anchorX:g,children:x},c)})})},le=({debts:n,onPaidSuccess:d})=>{var u,g,a;const[s,i]=r.useState({isOpen:!1,debtId:null});r.useEffect(()=>{console.log(n)});const f=t=>{i({isOpen:!0,debtId:t})},o=async()=>{if(!s.debtId){i({isOpen:!1,debtId:null});return}try{const t=U.currentUser;if(!t)throw new Error("尚未登入");const l=await t.getIdToken();await L.post(`/settlement/debts/${s.debtId}/mark-paid`,{},{headers:{Authorization:`Bearer ${l}`}}),d&&d()}catch{alert("標記失敗，請稍後再試。")}i({isOpen:!1,debtId:null})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-md font-medium text-[#263238] mb-3",children:"分帳關係"}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-auto",children:e.jsx(Z,{children:n.length>0?n.map(t=>e.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.3}},className:"bg-white border border-gray-300 rounded-md p-3 flex flex-col items-center justify-between",children:e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 mr-2"}),e.jsx("span",{className:"text-sm text-[#263238]",children:t.fromUserName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"➜"}),e.jsxs("span",{className:"text-sm text-[#EF4444] font-medium",children:["$",t.amount]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 mr-2"}),e.jsx("span",{className:"text-sm text-[#263238]",children:t.toUserName})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-400"}),e.jsx(I,{className:"w-[72px] h-[28px] text-xs bg-[#00C4CC] text-white rounded",onClick:()=>f(t.id),disabled:t.paid,children:t.paid?"已還款":"標記已付"})]})]})},t.id)):e.jsx("p",{className:"text-sm text-[#9CA3AF] text-center",children:"目前無未還款債務"})})})]}),e.jsx(z,{open:s.isOpen,onOpenChange:t=>i({isOpen:t,debtId:null}),children:e.jsxs(A,{className:"sm:max-w-[425px] bg-white border border-gray-300 rounded-md p-4 text-black",children:[e.jsxs(F,{children:[e.jsx(B,{children:"確認標記已還款"}),e.jsx(T,{children:s.debtId&&n.find(t=>t.id===s.debtId)&&e.jsxs(e.Fragment,{children:["確定要標記這筆債務為已還款嗎？",e.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded-md",children:[e.jsxs("p",{children:["付款人：",(u=n.find(t=>t.id===s.debtId))==null?void 0:u.fromUserName]}),e.jsxs("p",{children:["收款人：",(g=n.find(t=>t.id===s.debtId))==null?void 0:g.toUserName]}),e.jsxs("p",{children:["金額：$",(a=n.find(t=>t.id===s.debtId))==null?void 0:a.amount]})]})]})})]}),e.jsxs(H,{className:"sm:justify-start",children:[e.jsx(I,{type:"button",variant:"secondary",onClick:()=>i({isOpen:!1,debtId:null}),className:"w-20 h-10 border-[#D1D5DB] rounded-md bg-muted text-muted-foreground hover:bg-muted/90",children:"取消"}),e.jsx(I,{type:"button",onClick:o,className:"bg-[#00C4CC] hover:bg-[#00A3A9]",children:"確認已還款"})]})]})})]})};export{le as D,ae as P};
